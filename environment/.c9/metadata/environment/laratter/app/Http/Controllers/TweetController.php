{"filter":false,"title":"TweetController.php","tooltip":"/laratter/app/Http/Controllers/TweetController.php","ace":{"folds":[],"scrolltop":1736.5999999999992,"scrollleft":0,"selection":{"start":{"row":126,"column":18},"end":{"row":126,"column":18},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"hash":"f9ea6c5182bad84208e49ef90250cb83cccfd0d1","undoManager":{"mark":52,"position":52,"stack":[[{"start":{"row":5,"column":0},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":15},{"start":{"row":6,"column":0},"end":{"row":7,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":7,"column":0},"end":{"row":8,"column":0},"action":"insert","lines":["",""],"id":16}],[{"start":{"row":6,"column":0},"end":{"row":7,"column":21},"action":"insert","lines":["use Validator;","use App\\Models\\Tweet;"],"id":17}],[{"start":{"row":8,"column":0},"end":{"row":9,"column":0},"action":"remove","lines":["",""],"id":18}],[{"start":{"row":16,"column":10},"end":{"row":17,"column":0},"action":"insert","lines":["",""],"id":19},{"start":{"row":17,"column":0},"end":{"row":17,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":17,"column":4},"end":{"row":17,"column":8},"action":"remove","lines":["    "],"id":20}],[{"start":{"row":17,"column":4},"end":{"row":17,"column":43},"action":"insert","lines":["return response()->view('tweet.index');"],"id":21}],[{"start":{"row":25,"column":10},"end":{"row":26,"column":0},"action":"insert","lines":["",""],"id":22},{"start":{"row":26,"column":0},"end":{"row":26,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":26,"column":4},"end":{"row":26,"column":8},"action":"remove","lines":["    "],"id":23}],[{"start":{"row":26,"column":4},"end":{"row":26,"column":44},"action":"insert","lines":["return response()->view('tweet.create');"],"id":24}],[{"start":{"row":16,"column":10},"end":{"row":17,"column":0},"action":"insert","lines":["",""],"id":25},{"start":{"row":17,"column":0},"end":{"row":17,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":17,"column":4},"end":{"row":17,"column":8},"action":"remove","lines":["    "],"id":26}],[{"start":{"row":17,"column":4},"end":{"row":17,"column":17},"action":"insert","lines":["$tweets = [];"],"id":27}],[{"start":{"row":18,"column":41},"end":{"row":18,"column":59},"action":"insert","lines":[",compact('tweets')"],"id":28}],[{"start":{"row":35,"column":10},"end":{"row":51,"column":42},"action":"insert","lines":["// バリデーション","  $validator = Validator::make($request->all(), [","    'tweet' => 'required | max:191',","    'description' => 'required',","  ]);","  // バリデーション:エラー","  if ($validator->fails()) {","    return redirect()","      ->route('tweet.create')","      ->withInput()","      ->withErrors($validator);","  }","  // create()は最初から用意されている関数","  // 戻り値は挿入されたレコードの情報","  $result = Tweet::create($request->all());","  // ルーティング「tweet.index」にリクエスト送信（一覧ページに移動）","  return redirect()->route('tweet.index');"],"id":30}],[{"start":{"row":17,"column":0},"end":{"row":18,"column":61},"action":"remove","lines":["    $tweets = [];","    return response()->view('tweet.index',compact('tweets'));"],"id":31},{"start":{"row":17,"column":0},"end":{"row":18,"column":59},"action":"insert","lines":["  $tweets = Tweet::getAllOrderByUpdated_at();","  return response()->view('tweet.index',compact('tweets'));"]}],[{"start":{"row":57,"column":26},"end":{"row":57,"column":31},"action":"remove","lines":["tring"],"id":32}],[{"start":{"row":57,"column":26},"end":{"row":57,"column":27},"action":"remove","lines":[" "],"id":33},{"start":{"row":57,"column":25},"end":{"row":57,"column":26},"action":"remove","lines":["s"]}],[{"start":{"row":59,"column":5},"end":{"row":60,"column":58},"action":"insert","lines":["  $tweet = Tweet::find($id);","  return response()->view('tweet.show', compact('tweet'));"],"id":34}],[{"start":{"row":59,"column":2},"end":{"row":59,"column":7},"action":"remove","lines":["     "],"id":35}],[{"start":{"row":82,"column":28},"end":{"row":82,"column":35},"action":"remove","lines":["string "],"id":36}],[{"start":{"row":84,"column":5},"end":{"row":85,"column":42},"action":"insert","lines":[" $result = Tweet::find($id)->delete();","  return redirect()->route('tweet.index');"],"id":37}],[{"start":{"row":84,"column":2},"end":{"row":84,"column":6},"action":"remove","lines":["    "],"id":38}],[{"start":{"row":66,"column":31},"end":{"row":66,"column":32},"action":"remove","lines":[" "],"id":39},{"start":{"row":66,"column":30},"end":{"row":66,"column":31},"action":"remove","lines":["g"]},{"start":{"row":66,"column":29},"end":{"row":66,"column":30},"action":"remove","lines":["n"]},{"start":{"row":66,"column":28},"end":{"row":66,"column":29},"action":"remove","lines":["i"]},{"start":{"row":66,"column":27},"end":{"row":66,"column":28},"action":"remove","lines":["r"]},{"start":{"row":66,"column":26},"end":{"row":66,"column":27},"action":"remove","lines":["t"]},{"start":{"row":66,"column":25},"end":{"row":66,"column":26},"action":"remove","lines":["s"]}],[{"start":{"row":68,"column":4},"end":{"row":69,"column":58},"action":"insert","lines":[" $tweet = Tweet::find($id);","  return response()->view('tweet.edit', compact('tweet'));"],"id":40}],[{"start":{"row":69,"column":1},"end":{"row":69,"column":2},"action":"insert","lines":["　"],"id":41}],[{"start":{"row":68,"column":2},"end":{"row":68,"column":3},"action":"remove","lines":[" "],"id":42}],[{"start":{"row":69,"column":62},"end":{"row":69,"column":65},"action":"remove","lines":[" //"],"id":43}],[{"start":{"row":68,"column":0},"end":{"row":69,"column":62},"action":"remove","lines":["    $tweet = Tweet::find($id);"," 　 return response()->view('tweet.edit', compact('tweet'));   "],"id":49}],[{"start":{"row":68,"column":0},"end":{"row":69,"column":58},"action":"insert","lines":["$tweet = Tweet::find($id);","  return response()->view('tweet.edit', compact('tweet'));"],"id":50}],[{"start":{"row":75,"column":44},"end":{"row":75,"column":52},"action":"remove","lines":[" string "],"id":51}],[{"start":{"row":75,"column":44},"end":{"row":75,"column":45},"action":"insert","lines":[" "],"id":52}],[{"start":{"row":77,"column":4},"end":{"row":87,"column":31},"action":"insert","lines":[" //バリデーション","  $validator = Validator::make($request->all(), [","    'tweet' => 'required | max:191',","    'description' => 'required',","  ]);","  //バリデーション:エラー","  if ($validator->fails()) {","    return redirect()","      ->route('tweet.edit', $id)","      ->withInput()","      ->withErrors($validator);"],"id":53}],[{"start":{"row":88,"column":5},"end":{"row":89,"column":0},"action":"insert","lines":["",""],"id":54},{"start":{"row":89,"column":0},"end":{"row":89,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":89,"column":4},"end":{"row":94,"column":0},"action":"insert","lines":["  }","  //データ更新処理","  $result = Tweet::find($id)->update($request->all());","  return redirect()->route('tweet.index');","}",""],"id":55},{"start":{"row":89,"column":0},"end":{"row":89,"column":6},"action":"remove","lines":["      "]},{"start":{"row":89,"column":0},"end":{"row":89,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":88,"column":4},"end":{"row":88,"column":5},"action":"remove","lines":["}"],"id":56}],[{"start":{"row":7,"column":21},"end":{"row":8,"column":0},"action":"insert","lines":["",""],"id":57},{"start":{"row":8,"column":0},"end":{"row":9,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":9,"column":0},"end":{"row":9,"column":9},"action":"insert","lines":["use Auth;"],"id":58}],[{"start":{"row":50,"column":21},"end":{"row":51,"column":0},"action":"insert","lines":["",""],"id":59},{"start":{"row":51,"column":0},"end":{"row":51,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":51,"column":2},"end":{"row":51,"column":66},"action":"insert","lines":["$data = $request->merge(['user_id' => Auth::user()->id])->all();"],"id":60}],[{"start":{"row":7,"column":21},"end":{"row":8,"column":0},"action":"remove","lines":["",""],"id":61}],[{"start":{"row":4,"column":28},"end":{"row":5,"column":0},"action":"remove","lines":["",""],"id":62}],[{"start":{"row":7,"column":9},"end":{"row":8,"column":0},"action":"insert","lines":["",""],"id":63}],[{"start":{"row":8,"column":0},"end":{"row":8,"column":20},"action":"insert","lines":["use App\\Models\\User;"],"id":64}],[{"start":{"row":105,"column":5},"end":{"row":106,"column":0},"action":"insert","lines":["",""],"id":65},{"start":{"row":106,"column":0},"end":{"row":106,"column":4},"action":"insert","lines":["    "]},{"start":{"row":106,"column":4},"end":{"row":107,"column":0},"action":"insert","lines":["",""]},{"start":{"row":107,"column":0},"end":{"row":107,"column":4},"action":"insert","lines":["    "]},{"start":{"row":107,"column":4},"end":{"row":108,"column":0},"action":"insert","lines":["",""]},{"start":{"row":108,"column":0},"end":{"row":108,"column":4},"action":"insert","lines":["    "]},{"start":{"row":108,"column":4},"end":{"row":109,"column":0},"action":"insert","lines":["",""]},{"start":{"row":109,"column":0},"end":{"row":109,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":107,"column":4},"end":{"row":116,"column":3},"action":"insert","lines":["  public function mydata()","  {","    // Userモデルに定義したリレーションを使用してデータを取得する．","    $tweets = User::query()","      ->find(Auth::user()->id)","      ->userTweets()","      ->orderBy('created_at','desc')","      ->get();","    return response()->view('tweet.index', compact('tweets'));","  }"],"id":66}],[{"start":{"row":106,"column":4},"end":{"row":107,"column":0},"action":"insert","lines":["",""],"id":67},{"start":{"row":107,"column":0},"end":{"row":107,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":118,"column":0},"end":{"row":118,"column":4},"action":"remove","lines":["    "],"id":68},{"start":{"row":117,"column":3},"end":{"row":118,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":118,"column":0},"end":{"row":118,"column":1},"action":"remove","lines":[" "],"id":69}],[{"start":{"row":118,"column":0},"end":{"row":119,"column":0},"action":"insert","lines":["",""],"id":70},{"start":{"row":119,"column":0},"end":{"row":120,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":106,"column":2},"end":{"row":106,"column":4},"action":"remove","lines":["  "],"id":71},{"start":{"row":106,"column":0},"end":{"row":106,"column":2},"action":"remove","lines":["  "]},{"start":{"row":105,"column":5},"end":{"row":106,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":118,"column":0},"end":{"row":130,"column":0},"action":"insert","lines":["public function timeline()","{","  // フォローしているユーザを取得する","  $followings = User::find(Auth::id())->followings->pluck('id')->all();","  // 自分とフォローしている人が投稿したツイートを取得する","  $tweets = Tweet::query()","    ->where('user_id', Auth::id())","    ->orWhereIn('user_id', $followings)","    ->orderBy('updated_at', 'desc')","    ->get();","  return response()->view('tweet.index', compact('tweets'));","}",""],"id":72}],[{"start":{"row":129,"column":1},"end":{"row":130,"column":0},"action":"remove","lines":["",""],"id":73}]]},"timestamp":1691330170827}